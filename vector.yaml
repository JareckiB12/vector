api:
  enabled: true
  address: 0.0.0.0:8686
  playground: true

sources:
  docker:
    type: docker_logs
  
  internal_metrics:
    type: internal_metrics

transforms:
  # Filtruj logi zawierające "hello-world"
  filter_hello_world:
    type: filter
    inputs:
      - docker
    condition:
      type: vrl
      source: contains(string!(.message), "hello-world")
  
  # Zlicz przefiltrowane logi jako metrykę
  hello_world_counter:
    type: log_to_metric
    inputs:
      - filter_hello_world
    metrics:
      - type: counter
        field: message
        name: hello_world_occurrences_total
        # namespace: custom # dodaje taki przedrostek do metryki

sinks:
  console:
    inputs:
      - docker
    type: console
    encoding:
      codec: json
  
  prometheus_exporter:
    type: prometheus_exporter
    inputs:
      - internal_metrics
      - hello_world_counter
    address: 0.0.0.0:9598
